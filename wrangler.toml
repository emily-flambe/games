name = "games"
main = "src/index.ts"
compatibility_date = "2024-12-30"

# Production routes (not inherited by preview)
[env.production]
routes = [
  { pattern = "games.emilycogsdill.com/*", zone_name = "emilycogsdill.com" }
]

[dev]
port = 8777

# Durable Objects
[[durable_objects.bindings]]
name = "GAME_SESSIONS"
class_name = "GameSession"

[[durable_objects.bindings]]
name = "CHECKBOX_SESSIONS"
class_name = "CheckboxGameSession"

[[durable_objects.bindings]]
name = "EVERYBODY_VOTES_SESSIONS"
class_name = "EverybodyVotesGameSession"

[[durable_objects.bindings]]
name = "COUNTY_GAME_SESSIONS"
class_name = "CountyGameSession"

[[durable_objects.bindings]]
name = "GAME_REGISTRY"
class_name = "GameSessionRegistry"

# Durable Object Migrations
[[migrations]]
tag = "v1"
new_classes = [ "GameSession" ]

[[migrations]]
tag = "v2"
new_classes = [ "GameSessionRegistry" ]

[[migrations]]
tag = "v3"
new_classes = [ "CheckboxGameSession", "EverybodyVotesGameSession" ]

[[migrations]]
tag = "v4"
new_classes = [ "CountyGameSession" ]

# Preview Environment Configuration
# Each preview deployment gets its own subdomain on workers.dev
[env.preview]
name = "games-preview"
# Preview deployments use workers.dev subdomain
# The actual subdomain will be set dynamically in CI/CD

# Durable Objects (inherited from top level)
[[env.preview.durable_objects.bindings]]
name = "GAME_SESSIONS"
class_name = "GameSession"

[[env.preview.durable_objects.bindings]]
name = "CHECKBOX_SESSIONS"
class_name = "CheckboxGameSession"

[[env.preview.durable_objects.bindings]]
name = "EVERYBODY_VOTES_SESSIONS"
class_name = "EverybodyVotesGameSession"

[[env.preview.durable_objects.bindings]]
name = "COUNTY_GAME_SESSIONS"
class_name = "CountyGameSession"

[[env.preview.durable_objects.bindings]]
name = "GAME_REGISTRY"
class_name = "GameSessionRegistry"