name = "games"
main = "src/index.ts"
compatibility_date = "2024-12-30"

# Production routes (not inherited by preview)
[env.production]
routes = [
  { pattern = "games.emilycogsdill.com/*", zone_name = "emilycogsdill.com" }
]

# Production Durable Objects
[[env.production.durable_objects.bindings]]
name = "GAME_SESSIONS"
class_name = "GameSession"

[[env.production.durable_objects.bindings]]
name = "GAME_REGISTRY"
class_name = "GameSessionRegistry"

[dev]
port = 8777

# Durable Objects
[[durable_objects.bindings]]
name = "GAME_SESSIONS"
class_name = "GameSession"

[[durable_objects.bindings]]
name = "GAME_REGISTRY"
class_name = "GameSessionRegistry"

# Durable Object Migrations
[[migrations]]
tag = "v1"
new_classes = [ "GameSession" ]

[[migrations]]
tag = "v2"
new_classes = [ "GameSessionRegistry" ]

[[migrations]]
tag = "v3"
new_classes = [ "CheckboxGameSession", "EverybodyVotesGameSession" ]

[[migrations]]
tag = "v4"
new_classes = [ "CountyGameSession" ]

# Note: Legacy DO classes (CheckboxGameSession, EverybodyVotesGameSession, CountyGameSession)
# are kept registered for migration history but are no longer used.
# All games now use the unified GameSession with handler registry.

# Staging Environment Configuration
# Deployed on merge to main
[env.staging]
name = "games-staging"

# Staging Durable Objects
[[env.staging.durable_objects.bindings]]
name = "GAME_SESSIONS"
class_name = "GameSession"

[[env.staging.durable_objects.bindings]]
name = "GAME_REGISTRY"
class_name = "GameSessionRegistry"

# Preview Environment Configuration
# Single preview deployment for testing changes before production
[env.preview]
name = "games-preview"
# Preview deployments use workers.dev subdomain

# Durable Objects (inherited from top level)
[[env.preview.durable_objects.bindings]]
name = "GAME_SESSIONS"
class_name = "GameSession"

[[env.preview.durable_objects.bindings]]
name = "GAME_REGISTRY"
class_name = "GameSessionRegistry"
